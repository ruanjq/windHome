(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{183:function(t,e,a){"use strict";a.r(e);var s=a(2),v=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"android7-0-whistle-抓包https证书无效解决方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#android7-0-whistle-抓包https证书无效解决方法"}},[t._v("#")]),t._v(" Android7.0 whistle 抓包HTTPS证书无效解决方法")]),t._v(" "),a("h2",{attrs:{id:"背景原因"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#背景原因"}},[t._v("#")]),t._v(" 背景原因")]),t._v(" "),a("p",[t._v("最近做小程序h5开发，调试过程中发现android 系统微信7.0以上版本无法抓取https 请求日志，查阅资料得出以下结论：")]),t._v(" "),a("ul",[a("li",[t._v("安卓系统 7.0 以上版本，微信 7.0 以下版本，微信会信任系统提供的证书")]),t._v(" "),a("li",[t._v("安卓系统 7.0 以上版本，微信 7.0 以上版本，微信只信任它自己配置的证书列表")])]),t._v(" "),a("p",[t._v("所以在"),a("code",[t._v("android")]),t._v("系统中"),a("code",[t._v("whistle")]),t._v("抓包工具中才无法获取"),a("code",[t._v("https")]),t._v("相关日志，"),a("strong",[t._v("苹果"),a("code",[t._v("IOS")]),t._v("系统则默认会信任用户安装的证书，没有这个问题")])]),t._v(" "),a("h2",{attrs:{id:"解决方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#解决方式"}},[t._v("#")]),t._v(" 解决方式")]),t._v(" "),a("p",[a("strong",[t._v("注意：前提"),a("code",[t._v("android")]),t._v("手机需要获取"),a("code",[t._v("root")]),t._v("权限，具体"),a("code",[t._v("root")]),t._v("方法请查阅相关资料")]),t._v("\n这里以"),a("code",[t._v("小米8")]),t._v("手机为例：")]),t._v(" "),a("h3",{attrs:{id:"获取root权限方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#获取root权限方法"}},[t._v("#")]),t._v(" 获取root权限方法")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"http://www.miui.com/unlock/index.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("解锁小米手机"),a("OutboundLink")],1)]),t._v(" "),a("li",[a("a",{attrs:{href:"https://www.miui.com/download-345.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("下载miui开发版"),a("OutboundLink")],1),t._v(",并安装开发版系统")]),t._v(" "),a("li",[t._v("获取"),a("code",[t._v("ROOT")]),t._v("权限 开发版系统安装完成后，依次执行 "),a("strong",[t._v("手机管家->权限->ROOT权限管理->开启root权限")])])]),t._v(" "),a("h3",{attrs:{id:"证书文件重新命名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#证书文件重新命名"}},[t._v("#")]),t._v(" 证书文件重新命名")]),t._v(" "),a("p",[t._v("此过程是将证书文件"),a("code",[t._v("rootCA.crt")]),t._v("重新命名为"),a("code",[t._v("hash")]),t._v("值文件，文件名"),a("code",[t._v("hash.0")]),t._v("，以"),a("code",[t._v(".0")]),t._v("后缀结尾,"),a("code",[t._v("hash")]),t._v("通过以下命令方式计算得来")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("w2 start")]),t._v("启动"),a("a",{attrs:{href:"http://wproxy.org/whistle/",target:"_blank",rel:"noopener noreferrer"}},[t._v("whistle"),a("OutboundLink")],1),t._v("抓包工具并下载"),a("code",[t._v("rootCA.crt")]),t._v("证书文件")]),t._v(" "),a("li",[t._v("计算"),a("code",[t._v("hash")]),t._v("值，打开"),a("code",[t._v("终端cmd")]),t._v("窗口，运行以下命令,")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("openssl x509 -subject_hash_old -in rootCA.crt\n")])])]),a("p",[t._v("得到如下结果 "),a("code",[t._v("e2bbc20f")]),t._v("即为该文件的"),a("code",[t._v("hash")]),t._v("值")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("BelieverdeMacBook-Pro:Downloads ruanjq$ openssl x509 -subject_hash_old -in rootCA.crt\ne2bbc20f\n-----BEGIN CERTIFICATE-----\nMIID9DCCAtygAwIBAgIBATANBgkqhkiG9w0BAQsFADCBhTEhMB8GA1UEAxMYd2hp\nc3RsZS4xNTU0ODA0MTMzNDkxODkxMQswCQYDVQQGEwJDTjELMAkGA1UECBMCWkox\nCzAJBgNVBAcTAkhaMSQwIgYDVQQKExsxNTU0ODA0MTMzNDkxODkxLndwcm94eS5v\ncmcxEzARBgNVBAsTCndwcm94eS5vcmcwHhcNMTgwNDA5MTAwMjEzWhcNMjkwNDA5\nMTAwMjEzWjCBhTEhMB8GA1UEAxMYd2hpc3RsZS4xNTU0ODA0MTMzNDkxODkxMQsw\nCQYDVQQGEwJDTjELMAkGA1UECBMCWkoxCzAJBgNVBAcTAkhaMSQwIgYDVQQKExsx\nNTU0ODA0MTMzNDkxODkxLndwcm94eS5vcmcxEzARBgNVBAsTCndwcm94eS5vcmcw\nggEiMA0GCSqGSIb3DQEBAQUAA4IBDwAwggEKAoIBAQD5vm4twleqKMCQbdD7BbRH\nk4CwJL79Bpj8Nl7z9En3KTc6emfYqVd2VejXqRky0zVi90HGG9sEXQikQBb8Gmm9\nqIGQ2wtUMTCHuLUOnfaNCqX0Tfd8Ln29yl0hHSln5b+PyUcFs+nGHmNcgdEQVIAe\nlGQO77iChU3Sm8jLm7m8KDygPG+lctF5key2o+EOY4bKfrR3w+eB1lCIpkVUDmkF\ni0YL0igWRCvqVQSjVsEFmNXtSptf2KEo4vJt1Nkxg3TTUl31p00LQg9utlpCcAps\n7bYyBH6ZtOZHdxLKw9YHcOXkwFki6fbd3kZkkSBr2rHHo+RzsO+OzFJ76ob+Be7t\nAgMBAAGjbTBrMAwGA1UdEwQFMAMBAf8wCwYDVR0PBAQDAgL0MDsGA1UdJQQ0MDIG\nCCsGAQUFBwMBBggrBgEFBQcDAgYIKwYBBQUHAwMGCCsGAQUFBwMEBggrBgEFBQcD\nCDARBglghkgBhvhCAQEEBAMCAPcwDQYJKoZIhvcNAQELBQADggEBAH+vvldg9cdC\na+cuCYRMHDdSB1UoLyChSmVZepnHMoKy1ut/9qzyBY/VPjHydZsPtxlvi/zT1dFq\nbHnXeJGy2FI2K9mP9HYs7kH5SAOP5L6u/VFzJnH3VyEDhVkSqGI0BaSt2cDx7fJO\ng72qanafk6ppAhwbh+4O0KxjxiNfs0McV7zNPOGa5iNr/l2JtpIFkNk6k982KT5I\ntIw9hC1lv/w8iGJ3I4FOcJIsG9VrmkJ17yWteGKQrKvCs5flQ8w2kVlwQckODghj\nCd3a10/wXQpMGJj+EfQCAd4XK2E3zfEHOfDJMuadoV1VVt4NS6jwpfijlLnJm/Yn\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("ULeLrERu7Ow")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("\n-----END CERTIFICATE-----\nBelieverdeMacBook-Pro:Downloads ruanjq$\n")])])]),a("ul",[a("li",[t._v("将"),a("code",[t._v("rootCA.crt")]),t._v("文件重新命令为"),a("code",[t._v("hash.0")]),t._v(",(比如我这里就改为 "),a("code",[t._v("e2bbc20f")]),t._v(",直接通过电脑重新命名文件即可，不需要通过命令方式)")])]),t._v(" "),a("h3",{attrs:{id:"证书文件添加到系统证书目录"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#证书文件添加到系统证书目录"}},[t._v("#")]),t._v(" 证书文件添加到系统证书目录")]),t._v(" "),a("p",[t._v("证书文件添加到系统证书目录有"),a("code",[t._v("2种")]),t._v("方式：")]),t._v(" "),a("ul",[a("li",[t._v("手机安装"),a("code",[t._v("RE文件管理器（Root Explorer）")]),t._v("，通过"),a("code",[t._v("RE文件管理器")]),t._v("将"),a("code",[t._v("hash.0")]),t._v("证书文件复制到系统证书目录"),a("code",[t._v("/system/etc/security/cacerts/")]),t._v("下面")]),t._v(" "),a("li",[t._v("安装"),a("code",[t._v("adb")]),t._v("开发工具，通过命令的形式将文件"),a("code",[t._v("push")]),t._v("到目录"),a("code",[t._v("/system/etc/security/cacerts/")]),t._v("下面")])]),t._v(" "),a("h4",{attrs:{id:"re文件管理器方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#re文件管理器方式"}},[t._v("#")]),t._v(" "),a("code",[t._v("RE文件管理器")]),t._v("方式")]),t._v(" "),a("ul",[a("li",[t._v("将"),a("code",[t._v("hash.0")]),t._v("证书文件发送到手机文件")]),t._v(" "),a("li",[t._v("下载并安装"),a("code",[t._v("RE文件管理器")]),t._v("，并将该软件开启"),a("code",[t._v("root")]),t._v("权限")]),t._v(" "),a("li",[t._v("进入RootExplorer管理器，将"),a("code",[t._v("hash.0")]),t._v("证书文件复制到"),a("code",[t._v("/system/etc/security/cacerts/")]),t._v("文件夹下，并把文件的权限设置成rw-r-r-")]),t._v(" "),a("li",[t._v("重启手机，进入 设置——系统安全——加密与凭据--信任的凭证——系统标签 里查看证书是否开启状态")])]),t._v(" "),a("h4",{attrs:{id:"adb工具方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#adb工具方式"}},[t._v("#")]),t._v(" "),a("code",[t._v("adb")]),t._v("工具方式")]),t._v(" "),a("ul",[a("li",[t._v("下载并安装"),a("code",[t._v("adb")]),t._v("工具，这里以"),a("code",[t._v("mac")]),t._v("电脑为例")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("brew "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" Caskroom/cask/android-platform-tools "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 没有安装homebrew的先安装homebrew")]),t._v("\n")])])]),a("ul",[a("li",[a("code",[t._v("adb")]),t._v("工具安装完成后,依次执行以下操作(以下命令运行没有报任何错误，则代表证书push成功)")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("adb devices "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 测试adb是否安装成功，成功了会出现设备的hash值")]),t._v("\nadb root\nadb disable-verity "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 禁用系统验证")]),t._v("\nadb push e2bbc20f.0 /system/etc/security/cacerts "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 安装证书到安卓系统证书目录")]),t._v("\nadb root\n")])])]),a("ul",[a("li",[t._v("重启手机，进入 设置——系统安全——加密与凭据--信任的凭证——系统标签 里查看证书是否开启状态")])]),t._v(" "),a("h2",{attrs:{id:"验证安装成功"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#验证安装成功"}},[t._v("#")]),t._v(" 验证安装成功")]),t._v(" "),a("p",[t._v("重启手机，进入 设置——系统安全——加密与凭据--信任的凭证——系统标签 里查看证书，本人这里装了2个证书，自己电脑和公司电脑\n"),a("img",{attrs:{src:"/images/front/certificate.jpg",alt:"Android7.0 whistle 抓包HTTPS证书无效解决方法",title:"Android7.0 whistle 抓包HTTPS证书无效解决方法"}})]),t._v(" "),a("h2",{attrs:{id:"注意"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注意"}},[t._v("#")]),t._v(" 注意")]),t._v(" "),a("ul",[a("li",[t._v("其他抓包工具"),a("code",[t._v("Charles")]),t._v(","),a("code",[t._v("Fiddler")]),t._v("等方法类似，本质的方法是将用户证书添加到系统证书目录，系统证书会默认信任获取"),a("code",[t._v("HTTPS")]),t._v("请求日志。")]),t._v(" "),a("li",[t._v("获取"),a("code",[t._v("root")]),t._v("权限过程中可能会导致手机异常情况，请谨慎操作。")])])])}),[],!1,null,null,null);e.default=v.exports}}]);