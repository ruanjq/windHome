<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue 高级面试题(一) | 風之家</title>
    <meta name="description" content="我不去想身后会不会袭来寒风冷雨，既然目标是地平线，留给世界的只能是背影">
    <link rel="icon" href="/images/icons/logo_256x256.png">
  <link rel="shortcut icon" type="image/x-icon" href="/icons/favicon.ico">
  <script>
            var _hmt = _hmt || [];
            (function() {
                var hm = document.createElement("script");
                hm.src = "https://hm.baidu.com/hm.js?ab4ebebbea4df8ea62cf5195aff6b3a2";
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(hm, s);
            })();
        </script>
  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#4BB547">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  <link rel="apple-touch-icon" href="/images/icons/logo_256x256.png">
  <link rel="mask-icon" href="/images/icons/safari-pinned-tab.svg" color="#4BB547">
  <meta name="msapplication-TileImage" content="/images/icons/logo_256x256.png">
  <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.7edc3160.css" as="style"><link rel="preload" href="/assets/js/app.fec97452.js" as="script"><link rel="preload" href="/assets/js/2.afb7b15b.js" as="script"><link rel="preload" href="/assets/js/24.b02c1fdc.js" as="script"><link rel="prefetch" href="/assets/js/10.89585319.js"><link rel="prefetch" href="/assets/js/11.ab9f05cc.js"><link rel="prefetch" href="/assets/js/12.8d854409.js"><link rel="prefetch" href="/assets/js/13.d6664b5f.js"><link rel="prefetch" href="/assets/js/14.f375236e.js"><link rel="prefetch" href="/assets/js/15.52e041ef.js"><link rel="prefetch" href="/assets/js/16.d4747b03.js"><link rel="prefetch" href="/assets/js/17.2ace01c0.js"><link rel="prefetch" href="/assets/js/18.c3461800.js"><link rel="prefetch" href="/assets/js/19.975aa371.js"><link rel="prefetch" href="/assets/js/20.722219cd.js"><link rel="prefetch" href="/assets/js/21.2d47a3de.js"><link rel="prefetch" href="/assets/js/22.b778fb7b.js"><link rel="prefetch" href="/assets/js/23.3a33b23a.js"><link rel="prefetch" href="/assets/js/25.dc4efd22.js"><link rel="prefetch" href="/assets/js/26.15f14c9c.js"><link rel="prefetch" href="/assets/js/27.0862047b.js"><link rel="prefetch" href="/assets/js/28.973e5190.js"><link rel="prefetch" href="/assets/js/29.0bf251c9.js"><link rel="prefetch" href="/assets/js/3.dc4002b9.js"><link rel="prefetch" href="/assets/js/30.eab7a140.js"><link rel="prefetch" href="/assets/js/31.90f997d9.js"><link rel="prefetch" href="/assets/js/32.f87f3894.js"><link rel="prefetch" href="/assets/js/33.c3c6c3f8.js"><link rel="prefetch" href="/assets/js/34.ba9eed17.js"><link rel="prefetch" href="/assets/js/35.2e866454.js"><link rel="prefetch" href="/assets/js/4.7ca75168.js"><link rel="prefetch" href="/assets/js/5.a203baaa.js"><link rel="prefetch" href="/assets/js/6.1d7b7ce2.js"><link rel="prefetch" href="/assets/js/7.7877a582.js"><link rel="prefetch" href="/assets/js/8.a95776d4.js"><link rel="prefetch" href="/assets/js/9.b420aee6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7edc3160.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/icons/logo_256x256.png" alt="風之家" class="logo"> <span class="site-name can-hide">風之家</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/" class="nav-link">博客列表</a></div><div class="nav-item"><a href="/front/" class="nav-link router-link-active">大前端</a></div><div class="nav-item"><a href="/resume/" class="nav-link">关于我</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于風之家</a></div> <a href="https://github.com/ruanjq/windhome" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/" class="nav-link">博客列表</a></div><div class="nav-item"><a href="/front/" class="nav-link router-link-active">大前端</a></div><div class="nav-item"><a href="/resume/" class="nav-link">关于我</a></div><div class="nav-item"><a href="/about/" class="nav-link">关于風之家</a></div> <a href="https://github.com/ruanjq/windhome" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/front" class="sidebar-heading clickable router-link-active open"><span> 大前端</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/front/HTMLCSS" class="sidebar-heading clickable"><span> HTML/CSS 简介</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/front/JavaScript" class="sidebar-heading clickable"><span> JavaScript简介</span> <span class="arrow right"></span></a> <!----></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/front/Vue" class="sidebar-heading clickable router-link-exact-active router-link-active open"><span> Vue 面试题</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/front/Vue/" class="active sidebar-link"> Vue 面试题</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front/Vue/#聊聊object-defineproperty" class="sidebar-link">聊聊Object.defineProperty</a></li><li class="sidebar-sub-header"><a href="/front/Vue/#object-defineproperty和proxy的区别" class="sidebar-link">Object.defineProperty和Proxy的区别</a></li><li class="sidebar-sub-header"><a href="/front/Vue/#vue的模板引擎" class="sidebar-link">Vue的模板引擎</a></li><li class="sidebar-sub-header"><a href="/front/Vue/#你认为vue-的核心是什么" class="sidebar-link">你认为Vue 的核心是什么</a></li><li class="sidebar-sub-header"><a href="/front/Vue/#单向数据流和双向数据流的理解" class="sidebar-link">单向数据流和双向数据流的理解</a></li><li class="sidebar-sub-header"><a href="/front/Vue/#什么是双向数据绑定-mvvm原理是什么" class="sidebar-link">什么是双向数据绑定,MVVM原理是什么</a></li><li class="sidebar-sub-header"><a href="/front/Vue/#什么是虚拟dom" class="sidebar-link">什么是虚拟DOM</a></li><li class="sidebar-sub-header"><a href="/front/Vue/#vue-中如何实现一个虚拟dom" class="sidebar-link">Vue 中如何实现一个虚拟DOM,</a></li><li class="sidebar-sub-header"><a href="/front/Vue/#diff-算法" class="sidebar-link">Diff 算法</a></li><li class="sidebar-sub-header"><a href="/front/Vue/#vue-nexttick实现原理" class="sidebar-link">Vue.nextTick实现原理</a></li><li class="sidebar-sub-header"><a href="/front/Vue/#babel-编译原理" class="sidebar-link">babel 编译原理</a></li><li class="sidebar-sub-header"><a href="/front/Vue/#vue是如何对template-模板进行编译的" class="sidebar-link">Vue是如何对template 模板进行编译的</a></li><li class="sidebar-sub-header"><a href="/front/Vue/#vue如何自定义指令" class="sidebar-link">Vue如何自定义指令</a></li><li class="sidebar-sub-header"><a href="/front/Vue/#keep-alive实现原理" class="sidebar-link">keep-alive实现原理</a></li></ul></li><li><a href="/front/Vue/virtualDOM.html" class="sidebar-link"> VirtualDOM 算法实现</a></li></ul></section></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/front/angular" class="sidebar-heading clickable"><span> Angular </span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue-高级面试题-一"><a href="#vue-高级面试题-一" class="header-anchor">#</a> Vue 高级面试题(一)</h1> <h2 id="聊聊object-defineproperty"><a href="#聊聊object-defineproperty" class="header-anchor">#</a> 聊聊Object.defineProperty</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 语法 Object.defineProperty(obj, prop, descriptor)</span>
<span class="token keyword">var</span> test <span class="token operator">=</span> <span class="token punctuation">{</span>b<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span>c<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> test <span class="token operator">=</span> <span class="token punctuation">{</span>b<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span>c<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">var</span> bValue<span class="token punctuation">;</span>
    Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span>test<span class="token punctuation">,</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
        configurable<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 配置对象属性是否可以被删除</span>
        enumerable<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>   <span class="token comment">// 当属性值为true时候,该属性才可以再for...in 和Object.keys中枚举,默认为false</span>
        writable<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">// 当writable 属性值为true时,value 值才能被赋值运算符改变</span>
        <span class="token function-variable function">get</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> bValue<span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;get 方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">set</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            bValue <span class="token operator">=</span> val<span class="token punctuation">;</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;set方法&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>test<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="object-defineproperty和proxy的区别"><a href="#object-defineproperty和proxy的区别" class="header-anchor">#</a> Object.defineProperty和Proxy的区别</h2> <p><strong>Object.defineProperty</strong></p> <ul><li>不能监听数组长度length属性的变化</li> <li>不能监听对象的添加，所以vue 必须先data 声明属性才有响应式效果,</li> <li>只能劫持对象的属性,因此需要对每个属性进行遍历</li></ul> <p><strong>Proxy</strong></p> <ul><li>可以监听数组长度length属性的变化</li> <li>可以监听对象的添加</li> <li>可以代理整个对象,不需要每个属性都遍历，提高代码性能</li></ul> <h2 id="vue的模板引擎"><a href="#vue的模板引擎" class="header-anchor">#</a> Vue的模板引擎</h2> <p>Vue使用mustache模板引擎,实现一个简易的模板引擎</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">var</span> tpl <span class="token operator">=</span> <span class="token string">&quot;您好，我叫{{name}},今年{{age}}岁&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span><span class="token string">&quot;hhh&quot;</span><span class="token punctuation">,</span>
    age<span class="token punctuation">:</span><span class="token string">&quot;20&quot;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">tpl<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 正则分组括号匹配,默认为贪婪模式，在量词后面添加?号表示惰性匹配</span>
    <span class="token keyword">return</span> tpl<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token regex">/\{\{(.+?)\}\}/g</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">$<span class="token number">1</span><span class="token punctuation">,</span>$<span class="token number">2</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// $1 表示匹配的完整字符串</span>
        <span class="token comment">// $2 表示匹配括号内的关键词</span>
        <span class="token keyword">return</span> data<span class="token punctuation">[</span>$<span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token function">render</span><span class="token punctuation">(</span>tpl<span class="token punctuation">,</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="你认为vue-的核心是什么"><a href="#你认为vue-的核心是什么" class="header-anchor">#</a> 你认为Vue 的核心是什么</h2> <ul><li>1：数据驱动</li> <li>2：组件思想</li> <li>3：MVVM 模式</li> <li>4：声明式开发，简洁的模板预发</li></ul> <h2 id="单向数据流和双向数据流的理解"><a href="#单向数据流和双向数据流的理解" class="header-anchor">#</a> 单向数据流和双向数据流的理解</h2> <ul><li>单向数据流指的是父组件只能通过props属性对应的属性值传给子组件，子组件值更新父组件无法收到更新</li> <li>双向数据流指的是父子组件可以互相传递数据,父组件修改值，子组件动态更新，子组件修改值，父组件也能动态响应更新
如何通过v-model, .sync 来实现双向数据流</li></ul> <h2 id="什么是双向数据绑定-mvvm原理是什么"><a href="#什么是双向数据绑定-mvvm原理是什么" class="header-anchor">#</a> 什么是双向数据绑定,MVVM原理是什么</h2> <p>双向数据绑定指的是数据模型（Module）和视图（Views）之间的双向绑定，其原理是采用数据劫持，并结合发布订阅模式的方式来实现
<strong>MVVM原理</strong></p> <ul><li>Vue先遍历所有data 属性（发布者）用Object.defineProperty劫持这些属性将其转为getter setter 数据响应式，Observer(数据劫持);</li> <li>Observer监听数据 然后给每个属性对应new Dep(),通过发布订阅模式,notify通知数据更新</li> <li>Compile 类编译模板当正则替换数据时候添加new Watcher监听对象，通知属性值更新</li> <li>Watcher 类观察者，声明一个update 方法，当新值和旧值不相等时，通过callback对dom更新</li></ul> <h2 id="什么是虚拟dom"><a href="#什么是虚拟dom" class="header-anchor">#</a> 什么是虚拟DOM</h2> <p>虚拟DOM 是通过JS对象数据结构模拟真实的DOM结构，通过算法实现DOM的创建和渲染，通过diff 算法对比DOM 差异，能提升页面的性能，减少DOM 回流操作</p> <h2 id="vue-中如何实现一个虚拟dom"><a href="#vue-中如何实现一个虚拟dom" class="header-anchor">#</a> Vue 中如何实现一个虚拟DOM,</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token comment">// &lt;ul id='list'&gt;</span>
<span class="token comment">//   &lt;li class='item'&gt;Item 1&lt;/li&gt;</span>
<span class="token comment">//   &lt;li class='item'&gt;Item 2&lt;/li&gt;</span>
<span class="token comment">//   &lt;li class='item'&gt;Item 3&lt;/li&gt;</span>
<span class="token comment">// &lt;/ul&gt;</span>

<span class="token comment">// 对应的JS 对象为</span>
<span class="token keyword">var</span> element <span class="token operator">=</span> <span class="token punctuation">{</span>
    tagName<span class="token punctuation">:</span><span class="token string">&quot;ul&quot;</span><span class="token punctuation">,</span>
    props<span class="token punctuation">:</span><span class="token punctuation">{</span>
        id<span class="token punctuation">:</span><span class="token string">&quot;list&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    children<span class="token punctuation">:</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span> tagName<span class="token punctuation">:</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span>props<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token keyword">class</span><span class="token punctuation">:</span><span class="token string">&quot;item&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>children<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">&quot;Item 1&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> tagName<span class="token punctuation">:</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span>props<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token keyword">class</span><span class="token punctuation">:</span><span class="token string">&quot;item&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>children<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">&quot;Item 2&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span> tagName<span class="token punctuation">:</span><span class="token string">&quot;li&quot;</span><span class="token punctuation">,</span>props<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token keyword">class</span><span class="token punctuation">:</span><span class="token string">&quot;item&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>children<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">&quot;Item 3&quot;</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">VNode</span><span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>data <span class="token operator">=</span> data<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span>

    <span class="token function">patch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 对比vnode 和oldVnode是否有差异，然后生成真实DOM</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre></div><h2 id="diff-算法"><a href="#diff-算法" class="header-anchor">#</a> Diff 算法</h2> <p>Diff 流程图
当数据发生改变时候，set 方法会调用Dep.notify 通知订阅者调用<code>watcher</code> <code>update</code> 方法，接着会调用<code>patch</code>给真实的DOM 打补丁，更新相应的视图。
参考：<a href="https://www.windhome.win/front/Vue/virtualDOM.html" target="_blank" rel="noopener noreferrer">VirtualDOM 算法实现<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> <img src="https://user-gold-cdn.xitu.io/2018/5/19/163777930be304eb?imageView2/0/w/1280/h/960/format/webp/ignore-error/1" alt="Diff 流程图" title="Diff 流程图"></p> <h2 id="vue-nexttick实现原理"><a href="#vue-nexttick实现原理" class="header-anchor">#</a> Vue.nextTick实现原理</h2> <p><code>DOM</code> 更新完毕后执行的一个回调
简单来说就是利用浏览器事件循环机制，首先属性修改是同步执行，当主线程执行栈为空的时候，浏览器事件循环<code>eventloop</code> 会去读取异步队列，当遇到nextTick 方法时候，会开启一个异步队列缓存改变的数据，而<code>Vue</code>是异步更新DOM的，当更新DOM执行完毕后，再读取 nextTick 队列执行，<code>Vue</code>在内部执行异步队列会尝试使用原生的<code>Promise.then</code> 和 <code>MessageChannel</code>方法，如果不支持，则采用<code>setTimeout(fn,0)</code> 代替，此时通过 Vue.nextTick 获取到改变后的 DOM 。通过 setTimeout(fn, 0) 也可以同样获取到。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>    <span class="token comment">// 改变数据</span>
    vm<span class="token punctuation">.</span>message <span class="token operator">=</span> <span class="token string">&quot;changed&quot;</span><span class="token punctuation">;</span>

     <span class="token comment">// 并不会得到'changed'</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$el<span class="token punctuation">.</span>textContent<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">//这样可以，nextTick里面的代码会在DOM更新后执行</span>
    Vue<span class="token punctuation">.</span><span class="token function">nextTick</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>vm<span class="token punctuation">.</span>$el<span class="token punctuation">.</span>textContent<span class="token punctuation">)</span> <span class="token comment">//可以得到'changed'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><p><img src="https://segmentfault.com/img/bV17xC?w=423&amp;h=512" alt="Vue.nextTick"></p> <h2 id="babel-编译原理"><a href="#babel-编译原理" class="header-anchor">#</a> babel 编译原理</h2> <p><code>babel</code>的主要功能就是将代码以字符串的形式传递给它，然后<code>babel</code> 内部进行编译转换，返回一段新的代码字符串(以及sourceMap)，输入ES6语言，转换ES5
<strong>编译步骤分为以下3个阶段</strong></p> <ul><li>parse 解析，将输入的代码解析为源代码抽象语法树<code>(AST Abstract Syntax Tree，是源代码语法结构的一种抽象表现形式，以树状的数据结构表示，树上的每个节点都表示源代码的一种结构)</code>，首先会将代码进行分词，将整段代码分割为语法单元数组，如（空白，注释，字符串，数字，标识符，运算符，括号），然后再进行语义分析，</li> <li>transform 转换，根据一定规则将抽象语法树进行转换</li> <li>generator 生成，使用<code>bebal-generator</code>插件将转换后的抽象语法树生成普通ES5代码字符串</li></ul> <h2 id="vue是如何对template-模板进行编译的"><a href="#vue是如何对template-模板进行编译的" class="header-anchor">#</a> Vue是如何对template 模板进行编译的</h2> <p>总结为三个过程,parse、optimize、render</p> <ul><li>parse 解析template，将字符串的template 转换为<code>AST (Abstract Syntax Tree)</code> 抽象语法树，得到指令，class ，style 等数据，<code>Vue</code> 对AST定义了三种类型,<code>Type 1: ASTElement</code>、<code>Type:2 ASTExpression</code>、<code>Type:3 ASTText</code>,假设我们有一个元素 <code>&lt;div id=&quot;test&quot;&gt;texttext&lt;/div&gt;</code>在 parse 完之后会变成如下的结构并返回</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code>ele1 <span class="token operator">=</span> <span class="token punctuation">{</span>
    type<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>
    tag<span class="token punctuation">:</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span>
    attrList<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span>value<span class="token punctuation">:</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    attrsMap<span class="token punctuation">:</span><span class="token punctuation">{</span>id<span class="token punctuation">:</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    parent<span class="token punctuation">:</span><span class="token keyword">undefined</span><span class="token punctuation">,</span>
    children<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
        type<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span>
        text<span class="token punctuation">:</span><span class="token string">&quot;texttext&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    plain<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    attrs<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span> <span class="token string">&quot;id&quot;</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token string">&quot;'test'&quot;</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>optimize 优化，将parse解析的AST进行静态内容的优化，标记所有的静态和非静态节点，在<code>Diff patch</code>的时候跳过静态内容的对比，达到优化的目的，（静态内容指的是和数据没有关系，不需要每次都属性的内容），经过optmizite 优化后，AST对象每个节点都会新增一个<code>static</code>属性</li> <li><code>generator</code>生成<code>render</code>：render 方法最终得到了一个函数字符串，它递归了AST树，为不同的AST节点创建不同的内部调用方法，如render函数字符串中会出现 _c，_v，_s，_q 方法，通过这些函数，render 函数最终会返回一个VNode节点，在_update 的时候对比原来的VNode,找出对应的patches 对象，进而更新DOM
参考：<a href="https://segmentfault.com/a/1190000015886547" target="_blank" rel="noopener noreferrer">Template 模板编译<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul> <h2 id="vue如何自定义指令"><a href="#vue如何自定义指令" class="header-anchor">#</a> Vue如何自定义指令</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token comment">// 注册</span>
Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'my-directive'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token function-variable function">bind</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">inserted</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">update</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">componentUpdated</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function-variable function">unbind</span><span class="token punctuation">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 注册指令函数</span>
Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'my-directive'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token comment">// 这里将会被 `bind` 和 `update` 调用</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 获取指令</span>
<span class="token keyword">var</span> myDirective <span class="token operator">=</span> Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'my-directive'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="keep-alive实现原理"><a href="#keep-alive实现原理" class="header-anchor">#</a> keep-alive实现原理</h2> <p><code>keep-alive</code>是<code>Vue</code>内置组件，它能够将不活动的组件保存在内存中，不被销毁，不会被渲染到真实的DOM中。提供exclude和include2个属性，进行动态缓存，也可以结合vue-router 来使用，
它提供2个生命钩子<code>created</code>和<code>destroyed</code>钩子,</p> <ul><li>create 会创建一个cache对象，保存VNode节点：</li> <li>destroyed 删除this.cache中缓存的VNode实例</li></ul> <p><strong>源代码</strong></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// src/core/components/keep-alive.js</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">'keep-alive'</span><span class="token punctuation">,</span>
  abstract<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 判断当前组件虚拟dom是否渲染成真是dom的关键</span>

  props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    include<span class="token punctuation">:</span> patternTypes<span class="token punctuation">,</span> <span class="token comment">// 缓存白名单</span>
    exclude<span class="token punctuation">:</span> patternTypes<span class="token punctuation">,</span> <span class="token comment">// 缓存黑名单</span>
    max<span class="token punctuation">:</span> <span class="token punctuation">[</span>String<span class="token punctuation">,</span> Number<span class="token punctuation">]</span> <span class="token comment">// 缓存的组件实例数量上限</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">created</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>cache <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token comment">// 缓存虚拟dom</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment">// 缓存的虚拟dom的健集合</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">destroyed</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> key <span class="token keyword">in</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 删除所有的缓存</span>
      <span class="token function">pruneCacheEntry</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>cache<span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>keys<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">mounted</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 实时监听黑白名单的变动</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token string">'include'</span><span class="token punctuation">,</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">pruneCache</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token function">matches</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span><span class="token string">'exclude'</span><span class="token punctuation">,</span> <span class="token parameter">val</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">pruneCache</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> <span class="token parameter">name</span> <span class="token operator">=&gt;</span> <span class="token operator">!</span><span class="token function">matches</span><span class="token punctuation">(</span>val<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>

  <span class="token function">render</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 先省略...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/ruanjq/windhome/edit/master/docs/front/Vue/README.md" target="_blank" rel="noopener noreferrer">Edit this page</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">最近修改::</span> <span class="time">2019-12-6 15:14:20</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/front/JavaScript/subscribeArray.html" class="prev"> JS数据订阅队列</a></span> <span class="next"><a href="/front/Vue/virtualDOM.html"> VirtualDOM 算法实现</a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.fec97452.js" defer></script><script src="/assets/js/2.afb7b15b.js" defer></script><script src="/assets/js/24.b02c1fdc.js" defer></script>
  </body>
</html>
